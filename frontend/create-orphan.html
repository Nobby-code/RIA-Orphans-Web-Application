<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Orphan</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Favicon -->
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="images/cropped-favicon-32x32.png"
    />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css" />

    <!--CSS Plugins-->
    <link rel="stylesheet" href="css/plugin.css" />
    <!-- Default CSS-->
    <link rel="stylesheet" href="css/default.css" />
    <!--Custom CSS-->
    <link rel="stylesheet" href="css/styles.css" />

    <!-- Font Awesome 4.7.0 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <!-- Font Awesome 5 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />

    <style>
      body {
        background: #eef1f5;
        padding: 40px 0;
      }
      .form-card {
        max-width: 650px;
        margin: 10px auto;
        background: #fff;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 6px 25px rgba(0, 0, 0, 0.1);
      }
      .btn-primary {
        border-radius: 30px;
        padding: 10px 18px;
      }
      button:disabled {
        cursor: not-allowed;
      }

      /* #imagePreview {
        border: 1px solid #dee2e6;
        padding: 5px;
        background: #fff;
      } */
    </style>
  </head>

  <body>
    <!-- Header Section Start -->
    <header class="position-relative z-3">
      <div class="header-top py-1 bg-secondary white">
        <div class="container">
          <div class="header-top-inner">
            <div class="row align-items-center">
              <div class="col-lg-6">
                <div class="header-top-left">
                  <ul class="list-unstyled d-flex gap-4 small">
                    <li>
                      <i class="fas fa-phone me-2 primary"></i>+254 726 299 430
                    </li>
                    <li>
                      <i class="far fa-envelope me-2 primary"></i
                      >info@riaorphansfoundation.org
                    </li>
                    <li>
                      <i class="far fa-clock me-2 primary"></i>Mon - Fri: 9:00 -
                      18:30
                    </li>
                  </ul>
                </div>
              </div>
              <div class="col-lg-6">
                <div
                  class="header-top-left d-flex align-items-center justify-content-end"
                >
                  <ul class="list-unstyled d-flex gap-4 me-5 small">
                    <li>
                      <a
                        href="https://www.facebook.com/people/RIA-Orphans-Foundation/61583941046523/"
                        target="_blank"
                        rel="noopener noreferrer"
                      >
                        <i class="fab fa-facebook-f"></i>
                      </a>
                    </li>
                    <li>
                      <a
                        href="https://x.com/orphans_ria"
                        target="_blank"
                        rel="noopener noreferrer"
                        ><i class="fab fa-twitter"></i
                      ></a>
                    </li>
                    <li>
                      <a href=""><i class="fab fa-instagram"></i></a>
                    </li>
                  </ul>
                  <a
                    href="donation-form.html"
                    class="btn-primary"
                    style="padding: 10px 20px"
                    >Donate Now<i class="fas fa-arrow-right ms-2"></i
                  ></a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="header-nav header-nav-menu py-3" id="header-nav-menu">
        <div class="container">
          <div class="header-nav-inner d-flex justify-content-between">
            <div class="header-logo">
              <a href="index.html"><img src="images/logo1.png" alt="logo" /></a>
            </div>
            <div class="header-nav-right d-flex align-items-center">
              <div
                class="navbar-collapse justify-content-center playfair"
                id="bs-example-navbar-collapse-1"
              >
                <ul
                  class="navbar-nav flex-row align-items-center"
                  id="responsive-menu"
                >
                  <li class="nav-item dropdown">
                    <a
                      class="nav-link dropdown-toggle text fw-bold active"
                      href="#"
                      role="button"
                      data-bs-toggle="dropdown"
                      aria-expanded="false"
                    >
                      Home
                    </a>
                    <ul
                      class="dropdown-menu bg-lightgrey p-0 rounded-0 border-0"
                    >
                      <li>
                        <a
                          class="dropdown-item fw-bold active text-capitalize black border-0"
                          href="index.html"
                          >Home</a
                        >
                      </li>
                      <li>
                        <a
                          class="dropdown-item fw-bold text-capitalize black border-0"
                          href="index-2.html"
                          >Our Mission</a
                        >
                      </li>
                      <!-- <li>
                        <a
                          class="dropdown-item fw-bold text-capitalize black border-0"
                          href="index-3.html"
                          >Home 3</a
                        >
                      </li> -->
                      <li>
                        <a
                          class="dropdown-item fw-bold text-capitalize black border-0"
                          href="index-4.html"
                          >Get Involved</a
                        >
                      </li>
                    </ul>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link text fw-bold" href="about.html">About</a>
                  </li>
                  <li class="nav-item dropdown">
                    <a
                      class="nav-link dropdown-toggle text fw-bold"
                      href="#"
                      role="button"
                      data-bs-toggle="dropdown"
                      aria-expanded="false"
                    >
                      Programs
                    </a>
                    <ul
                      class="dropdown-menu bg-lightgrey p-0 rounded-0 border-0"
                    >
                      <li>
                        <a
                          class="dropdown-item fw-bold text-capitalize black border-0"
                          href="cause-list.html"
                          >Programs List</a
                        >
                      </li>
                      <li>
                        <a
                          class="dropdown-item fw-bold text-capitalize black border-0"
                          href="cause-detail.html"
                          >Programs Details</a
                        >
                      </li>
                      <li>
                        <a
                          class="dropdown-item fw-bold text-capitalize black border-0"
                          href="orphans.html"
                          >Orphans & Widows List</a
                        >
                      </li>
                    </ul>
                  </li>
                  <li class="nav-item dropdown">
                    <a
                      class="nav-link dropdown-toggle text fw-bold"
                      href="#"
                      role="button"
                      data-bs-toggle="dropdown"
                      aria-expanded="false"
                    >
                      Event
                    </a>
                    <ul
                      class="dropdown-menu bg-lightgrey p-0 rounded-0 border-0"
                    >
                      <li>
                        <a
                          class="dropdown-item fw-bold text-capitalize black border-0"
                          href="event-list.html"
                          >Event List</a
                        >
                      </li>
                      <li>
                        <a
                          class="dropdown-item fw-bold text-capitalize black border-0"
                          href="event-detail.html"
                          >Event Details</a
                        >
                      </li>
                    </ul>
                  </li>
                  <li class="nav-item dropdown">
                    <a
                      class="nav-link dropdown-toggle text fw-bold"
                      href="#"
                      role="button"
                      data-bs-toggle="dropdown"
                      aria-expanded="false"
                    >
                      Quick Links
                    </a>
                    <ul
                      class="dropdown-menu bg-lightgrey p-0 rounded-0 border-0"
                    >
                      <li>
                        <a
                          class="dropdown-item fw-bold text-capitalize black border-0"
                          href="faq.html"
                          >Faq</a
                        >
                      </li>
                      <li>
                        <a
                          class="dropdown-item fw-bold text-capitalize black border-0"
                          href="testimonial.html"
                          >Testimonials</a
                        >
                      </li>
                      <li>
                        <a
                          class="dropdown-item fw-bold text-capitalize black border-0"
                          href="gallery.html"
                          >Gallery</a
                        >
                      </li>
                      <li>
                        <a
                          class="dropdown-item fw-bold text-capitalize black border-0"
                          href="volunteer.html"
                          >Volunteers</a
                        >
                      </li>
                      <li>
                        <a
                          class="dropdown-item fw-bold text-capitalize black border-0"
                          href="founders.html"
                          >Founders and members</a
                        >
                      </li>
                      <!-- <li>
                        <a
                          class="dropdown-item fw-bold text-capitalize black border-0"
                          href="search-result.html"
                          >Search Result</a
                        >
                      </li>
                      <li>
                        <a
                          class="dropdown-item fw-bold text-capitalize black border-0"
                          href="error.html"
                          >404Error</a
                        >
                      </li>
                      <li>
                        <a
                          class="dropdown-item fw-bold text-capitalize black border-0"
                          href="coming-soon.html"
                          >Coming Soon</a
                        >
                      </li> -->
                    </ul>
                  </li>
                  <li class="nav-item dropdown">
                    <a
                      class="nav-link dropdown-toggle fw-bold text fw-bold"
                      href="#"
                      role="button"
                      data-bs-toggle="dropdown"
                      aria-expanded="false"
                    >
                      Blog
                    </a>
                    <ul
                      class="dropdown-menu bg-lightgrey p-0 rounded-0 border-0"
                    >
                      <li>
                        <a
                          class="dropdown-item fw-bold text-capitalize black border-0"
                          href="blog-list.html"
                          >Blog List</a
                        >
                      </li>
                      <li>
                        <a
                          class="dropdown-item fw-bold text-capitalize black border-0"
                          href="blog-single.html"
                          >Blog Single</a
                        >
                      </li>
                    </ul>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link text fw-bold fw-bold" href="contact.html"
                      >Contact</a
                    >
                  </li>
                </ul>
              </div>
              <a href="#search1" class="mt_search text px-3">
                <i class="fa fa-search"></i>
              </a>
            </div>
            <div id="slicknav-mobile"></div>
          </div>
        </div>
        <div id="search1" class="search-popup">
          <button type="button" class="close">Ã—</button>
          <form>
            <input type="search" placeholder="Search..." />
            <a class="btn-primary rounded-0 border-0" href="search-result.html">
              <i class="fa fa-search text-white" aria-hidden="true"></i>
            </a>
          </form>
        </div>
      </div>
    </header>
    <!-- Header Section End -->

    <div class="form-card">
      <h3 class="fw-bold text-center mb-2">Create New Orphan</h3>
      <p class="text-muted text-center mb-4">
        Fill the details below to add orphan information
      </p>

      <form id="orphanForm">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="fw-semibold">Full Name</label>
            <input
              type="text"
              id="name"
              class="form-control"
              placeholder="Enter full name"
              required
            />
          </div>

          <div class="col-md-6 mb-3">
            <label class="fw-semibold">Gender</label>
            <select id="gender" class="form-select" required>
              <option>Male</option>
              <option>Female</option>
            </select>
          </div>

          <!-- <div class="col-md-6 mb-3">
            <label class="fw-semibold">Age</label>
            <input
              type="number"
              id="age"
              class="form-control"
              placeholder="Enter age"
              required
            />
          </div> -->
          <div class="col-md-6 mb-3">
            <label class="fw-semibold">Date of Birth</label>
            <input type="date" id="dob" class="form-control" required />
          </div>

          <div class="col-md-6 mb-3">
            <label class="fw-semibold">Age</label>
            <input type="number" id="age" class="form-control" readonly />
          </div>

          <div class="col-md-6 mb-3">
            <label class="fw-semibold">Orphan Type</label>
            <select id="orphanType" class="form-select" required>
              <option value="">Select orphan type</option>
              <option value="total">Total Orphan</option>
              <option value="partial">Partial Orphan</option>
            </select>
          </div>

          <div class="col-md-6 mb-3 d-none" id="deceasedParentGroup">
            <label class="fw-semibold">Who is Deceased?</label>
            <select id="deceasedParent" class="form-select">
              <option value="">Select parent</option>
              <option value="father">Father</option>
              <option value="mother">Mother</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="fw-semibold">Story / Background</label>
            <textarea
              id="description"
              class="form-control"
              rows="4"
              placeholder="Write a short story"
            ></textarea>
          </div>

          <div class="col-md-6 mb-3">
            <label class="fw-semibold">Upload Photo (optional)</label>
            <input
              type="file"
              id="image"
              class="form-control"
              accept="image/*"
            />
          </div>
        </div>

        <!-- Image Preview -->
        <div class="mt-3 text-center">
          <img
            id="imagePreview"
            src=""
            alt="Image Preview"
            class="img-fluid rounded shadow d-none"
            style="max-height: 200px"
          />
        </div>

        <!-- <div class="text-center">
          <button class="btn btn-primary w-100 rounded-0 mt-3">
            Save Orphan
          </button>
        </div> -->
        <button
          type="submit"
          id="submitBtn"
          class="btn btn-primary w-100 mt-3"
          autocomplete="off"
        >
          <span id="btnText">Save Orphan</span>
          <span
            id="btnSpinner"
            class="spinner-border spinner-border-sm ms-2 d-none"
            role="status"
            aria-hidden="true"
          ></span>
        </button>
      </form>
    </div>

    <!-- Success Modal -->
    <div
      class="modal fade"
      id="successModal"
      tabindex="-1"
      aria-labelledby="successModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0">
          <div class="modal-header bg-success text-white">
            <h5 class="modal-title" id="successModalLabel">
              <i class="fas fa-check-circle me-2"></i> Success
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>

          <div class="modal-body text-center py-4">
            <!-- <h5 class="mb-2">Orphan Created Successfully ðŸŽ‰</h5> -->
            <p class="text-muted mb-0">
              The orphan record saved successfully!.
            </p>
          </div>

          <div class="modal-footer justify-content-center">
            <button
              type="button"
              class="btn btn-success px-4"
              data-bs-dismiss="modal"
            >
              OK
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Error Modal -->
    <div class="modal fade" id="errorModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title">
              <i class="fas fa-times-circle me-2"></i> Error
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body text-center">
            <p id="errorMessage" class="mb-0"></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer Starts -->
    <footer class="section-padding position-relative pb-0">
      <div class="overlay"></div>
      <div class="container position-relative">
        <div class="footer-inner white text-center text-lg-start">
          <div class="footer-top pb-6 border-bottom border-1 border-light20">
            <div class="row gx-md-5 gy-5">
              <div class="col-lg-3">
                <div class="footer-info">
                  <div class="footer-logo">
                    <a href="index.html"
                      ><img
                        src="images/logo1.png"
                        alt="logo"
                        style="width: 240px"
                        class="mb-4"
                    /></a>
                  </div>
                  <div class="footer-info-inner">
                    <p class="mb-4">
                      We are committed to supporting vulnerable children through
                      education, shelter, healthcare, and emotional support.
                    </p>
                    <ul
                      class="d-flex social-links list-unstyled gap-2 justify-content-center justify-content-lg-start"
                    >
                      <li>
                        <a
                          href="https://www.facebook.com/profile.php?id=61583941046523"
                          ><i
                            class="fab fa-facebook text-center text-white rounded-circle bg-facebook"
                          ></i
                        ></a>
                      </li>
                      <li>
                        <a href="https://x.com/orphans_ria"
                          ><i
                            class="fab fa-twitter text-center text-white rounded-circle bg-twitter"
                          ></i
                        ></a>
                      </li>
                      <li>
                        <a
                          href="https://www.youtube.com/channel/UCG4aMjmm2HkCpe69y-GsoYg"
                          ><i
                            class="fab fa-youtube text-center text-white rounded-circle bg-youtube"
                          ></i
                        ></a>
                      </li>
                      <li>
                        <!-- <a href=""
                          ><i
                            class="fab fa-instagram text-center text-white rounded-circle bg-instagram"
                          ></i
                        ></a> -->
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="col-lg-2 col-md-6">
                <div class="footer-links">
                  <h4 class="white mb-4">Quick Links</h4>
                  <ul class="list-unstyled">
                    <li class="mb-3">
                      <a href="cause-list.html">Our Programs</a>
                    </li>
                    <li class="mb-3"><a href="about.html">About Us</a></li>
                    <li class="mb-3">
                      <a href="event-list.html">Our Misson</a>
                    </li>
                    <li>
                      <a href="founders.html">Founders and members</a>
                    </li>
                    <li class="mb-3"><a href="contact.html">Contact</a></li>
                    <li><a href="event-list.html">Latest Events</a></li>
                  </ul>
                </div>
              </div>
              <div class="col-lg-3 col-md-6">
                <div class="footer-contact">
                  <h4 class="white mb-4">Find Us</h4>
                  <ul class="list-unstyled">
                    <li class="mb-3">Ahero Centre, Kisumu City</li>
                    <li class="mb-3">needhelp@riafoundation.com</li>
                    <li>+254 726 299 430</li>
                  </ul>
                </div>
              </div>
              <div class="col-lg-4">
                <div class="footer-newsletter">
                  <h4 class="white mb-4">Weekly Newsletter</h4>
                  <form>
                    <input type="text" placeholder="Name" class="mb-3" />
                    <input type="email" placeholder="Your Email" class="mb-3" />
                    <button class="btn-primary w-100 border-0">
                      Subscribe
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <div class="footer-copyright py-3">
            <p class="mb-0 text-center">
              Â© 2025 riaorphansfoundation.org All rights reserved
            </p>
          </div>
        </div>
      </div>
    </footer>
    <!-- Footer Ends -->

    <script src="js/api.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const orphanType = document.getElementById("orphanType");
      const deceasedParentGroup = document.getElementById(
        "deceasedParentGroup"
      );
      const deceasedParent = document.getElementById("deceasedParent");

      const submitBtn = document.getElementById("submitBtn");
      const btnText = document.getElementById("btnText");
      const btnSpinner = document.getElementById("btnSpinner");

      // Image elements
      const imageInput = document.getElementById("image");
      const imagePreview = document.getElementById("imagePreview");

      // DOB and Age elements
      const dobInput = document.getElementById("dob");
      const ageInput = document.getElementById("age");

      function setLoading(isLoading) {
        if (isLoading) {
          submitBtn.disabled = true;
          btnText.innerText = "Saving...";
          btnSpinner.classList.remove("d-none");
        } else {
          submitBtn.disabled = false;
          btnText.innerText = "Save Orphan";
          btnSpinner.classList.add("d-none");
        }
      }

      document
        .getElementById("orphanForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          setLoading(true);

          const formData = new FormData();
          formData.append("name", document.getElementById("name").value);
          formData.append("gender", document.getElementById("gender").value);
          formData.append("dob", document.getElementById("dob").value);
          formData.append("age", document.getElementById("age").value);
          formData.append(
            "orphanType",
            document.getElementById("orphanType").value
          );

          if (orphanType.value === "partial") {
            formData.append(
              "deceasedParent",
              document.getElementById("deceasedParent").value
            );
          }
          formData.append(
            "description",
            document.getElementById("description").value
          );

          const imageFile = document.getElementById("image").files[0];
          if (imageFile) {
            formData.append("image", imageFile);
          }

          try {
            const res = await createOrphan(formData);

            setLoading(false);

            if (res.success) {
              // alert("Orphan created successfully!");
              document.getElementById("orphanForm").reset();
              imagePreview.src = "";
              imagePreview.classList.add("d-none");
              const successModal = new bootstrap.Modal(
                document.getElementById("successModal")
              );
              successModal.show();
            } else {
              // alert(res.message || "Failed to create orphan");
              document.getElementById("errorMessage").innerText =
                res.message || "Failed to create orphan";
              const errorModal = new bootstrap.Modal(
                document.getElementById("errorModal")
              );
              errorModal.show();
            }
          } catch (err) {
            setLoading(false);
            console.error("Error creating orphan:", err);
            document.getElementById("errorMessage").innerText =
              "An error occured, Try again.";
            const errorModal = new bootstrap.Modal(
              document.getElementById("errorModal")
            );
            errorModal.show();
          } finally {
            setLoading(false);
          }
        });

      // Show/hide deceased parent based on orphan type
      orphanType.addEventListener("change", () => {
        if (orphanType.value === "partial") {
          deceasedParentGroup.classList.remove("d-none");
          deceasedParent.setAttribute("required", "required");
        } else {
          deceasedParentGroup.classList.add("d-none");
          deceasedParent.removeAttribute("required");
        }
      });

      // Image preview
      imageInput.addEventListener("change", () => {
        const file = imageInput.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            imagePreview.src = e.target.result;
            imagePreview.classList.remove("d-none");
          };
          reader.readAsDataURL(file);
        } else {
          imagePreview.src = "";
          imagePreview.classList.add("d-none");
        }
      });

      // Auto-calculate age from DOB
      dobInput.addEventListener("change", () => {
        const dob = new Date(dobInput.value);
        const today = new Date();

        if (!dobInput.value) {
          ageInput.value = "";
          return;
        }

        let age = today.getFullYear() - dob.getFullYear();
        const monthDiff = today.getMonth() - dob.getMonth();
        const dayDiff = today.getDate() - dob.getDate();

        // Adjust age if birthday hasn't occurred yet this year
        if (monthDiff < 0 || (monthDiff === 0 && dayDiff < 0)) {
          age--;
        }

        ageInput.value = age >= 0 ? age : "";
      });
      dobInput.max = new Date().toISOString().split("T")[0];
    </script>
  </body>
</html>
